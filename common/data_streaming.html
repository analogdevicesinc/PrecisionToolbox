

<!doctype html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

    <title>Data Streaming &#8212; Precision Toolbox for MATLAB  documentation</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/bizstyle.css" />
    
    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/sphinx_highlight.js"></script>
    <script src="../_static/bizstyle.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Examples" href="examples.html" />
    <link rel="prev" title="Installation" href="installation.html" />
    <meta name="viewport" content="width=device-width,initial-scale=1.0" />
    <!--[if lt IE 9]>
    <script src="_static/css3-mediaqueries.js"></script>
    <![endif]-->
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="examples.html" title="Examples"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="installation.html" title="Installation"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">Precision Toolbox for MATLAB  documentation</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">Data Streaming</a></li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <section id="data-streaming">
<h1>Data Streaming<a class="headerlink" href="#data-streaming" title="Permalink to this heading">¶</a></h1>
<p>Remote data streaming to and from hardware is made available through <a class="reference external" href="https://www.mathworks.com/help/matlab/matlab_prog/what-are-system-objects.html">system object interfaces</a> , which are unique for each component or platform. The hardware interfacing system objects provide a since class to both configure a given platform and move data back and forth from the device.</p>
<p>Command and control of hardware from MATLAB is accomplished by leveraging the <a class="reference external" href="https://wiki.analog.com/software/linux/docs/iio/iio">IIO drivers</a> built into the target platform’s kernel and <a class="reference external" href="https://wiki.analog.com/resources/tools-software/linux-software/libiio">libiio</a> which provides remote backends to control drivers across different backends. Backends can be Ethernet/IP/USB based. Below is a diagram of the different components in the stack for a setup targeting the evaluation of the AD7380, but the setup will be nearly similar for other ADCs as well.</p>
<blockquote>
<div><a class="reference internal image-reference" href="../_images/PCXEvalStack.png"><img alt="../_images/PCXEvalStack.png" src="../_images/PCXEvalStack.png" style="width: 600px;" /></a>
</div></blockquote>
<p>Since libiio is cross-platform it can be used from Windows, Linux, or macOS based systems. It is also a lower level library independent of MATLAB, so when moving toward production or untethered systems similar APIs that are used in MATLAB can be used in C, C++, Python, or other languages.</p>
<section id="connecting-and-configuration">
<h2>Connecting and Configuration<a class="headerlink" href="#connecting-and-configuration" title="Permalink to this heading">¶</a></h2>
<p>Connecting to hardware is done by setting the <strong>uri</strong> property of the system object interface. The <strong>uri</strong> for libiio always has the convention “<em>&lt; backend &gt;:&lt; address &gt;</em>”, where <em>backend</em> can be ethernet, ip or usb. <em>address</em> will be specific to the backend. This is documented in the <a class="reference external" href="https://analogdevicesinc.github.io/libiio/master/libiio/group__Context.html#gafdcee40508700fa395370b6c636e16fe">libiio API</a> .</p>
<p>Below is a basic example of setting up a generic ADC using an Ethernet/IP backend:</p>
<div class="highlight-MATLAB notranslate"><div class="highlight"><pre><span></span><span class="n">rx</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">adi</span><span class="p">.</span><span class="n">ADxxxx</span><span class="p">.</span><span class="n">Rx</span><span class="p">;</span>
<span class="n">rx</span><span class="p">.</span><span class="n">uri</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s">&#39;ip:analog.local&#39;</span><span class="p">;</span>
<span class="n">data</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">rx</span><span class="p">();</span>
</pre></div>
</div>
<p>With the code above, the hardware is not contacted until the operator or step method is called on line 3. Therefore, any properties that are set or defined before line 3 are not applied or updated on the hardware until after line 3. However, after line 3 has completed the object will become locked and certain configuration changes cannot be applied after this point. These will primarily sample rates and buffer sizes.</p>
<p>The state of the object follows the flow of the diagram below triggered by line 3 above.</p>
<p>Once the object becomes locked it must be released if the sample rate or buffers need to be modified. This will disconnect from the hardware:</p>
<div class="highlight-MATLAB notranslate"><div class="highlight"><pre><span></span><span class="n">rx</span><span class="p">.</span><span class="n">release</span><span class="p">();</span><span class="w"> </span><span class="c">% Release object</span>
</pre></div>
</div>
<p>To provide a complete example we can do more advanced configuration like so to demonstrate property changes:</p>
<div class="highlight-MATLAB notranslate"><div class="highlight"><pre><span></span><span class="n">rx</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">adi</span><span class="p">.</span><span class="n">ADxxxx</span><span class="p">.</span><span class="n">Rx</span><span class="p">;</span>
<span class="n">rx</span><span class="p">.</span><span class="n">uri</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s">&#39;ip:analog.local&#39;</span><span class="p">;</span>
<span class="n">rx</span><span class="p">.</span><span class="n">SamplesPerFrame</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">1024</span><span class="p">;</span>
<span class="n">rx</span><span class="p">.</span><span class="n">SampleRate</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">256000</span><span class="p">;</span>
<span class="n">data1</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">rx</span><span class="p">();</span>

<span class="c">% Update tunable property</span>
<span class="n">rx</span><span class="p">.</span><span class="n">SampleRate</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">128000</span><span class="p">;</span>
<span class="n">data2</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">rx</span><span class="p">();</span>

<span class="c">% Update non-tunable property</span>
<span class="n">rx</span><span class="p">.</span><span class="n">release</span><span class="p">();</span>
<span class="n">rx</span><span class="p">.</span><span class="n">SamplesPerFrame</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">4096</span><span class="p">;</span>
<span class="n">dataLargerBuffer</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">rx</span><span class="p">();</span>
</pre></div>
</div>
</section>
<section id="receiving-data">
<h2>Receiving Data<a class="headerlink" href="#receiving-data" title="Permalink to this heading">¶</a></h2>
<p>To receive or capture data from a given device first you must instantiate that device’s interface class. For a generic ADC, this would be as follows:</p>
<div class="highlight-MATLAB notranslate"><div class="highlight"><pre><span></span><span class="n">rx</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">adi</span><span class="p">.</span><span class="n">ADxxxx</span><span class="p">.</span><span class="n">Rx</span><span class="p">;</span>
</pre></div>
</div>
<p>Once instantiated you can configure the number of samples to be captured by setting the property <strong>SamplesPerFrame.</strong></p>
<div class="highlight-MATLAB notranslate"><div class="highlight"><pre><span></span><span class="n">rx</span><span class="p">.</span><span class="n">SamplesPerFrame</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mf">1e6</span><span class="p">;</span>
</pre></div>
</div>
<p><strong>SamplesPerFrame</strong> is the number of samples per channel which will be captured. If your device produces complex data (I and Q) this is the number of complex samples. There will be a limit to the maximum samples which can be collected. By default this is set to 2^20, but it may be possible to make it larger depending on hardware. Once the operator methods are used for a give instantiation, the object will become locked and the <strong>SamplesPerFrame</strong> property cannot be changed. This is known as a non-tunable property.</p>
<p>To actually collect the samples or perform the capture, the operator of the system object should be used or the <strong>step</strong> method as so:</p>
<div class="highlight-MATLAB notranslate"><div class="highlight"><pre><span></span><span class="n">data</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">rx</span><span class="p">();</span><span class="w"> </span><span class="c">% Operator method</span>
<span class="n">data</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">rx</span><span class="p">.</span><span class="n">step</span><span class="p">();</span><span class="w"> </span><span class="c">% Step method</span>
</pre></div>
</div>
<p>Both method calls are equivalent, and the produced matrix <strong>data</strong> will be of size [SamplesPerFrame x length(EnabledChannels)]. <strong>EnabledChannels</strong> determines the channels which data will be collected from. <strong>EnabledChannels</strong> is a [1xN] vector with indexes starting at 1 of the desired channels.</p>
</section>
<section id="continuous-data-acquisition">
<h2>Continuous Data Acquisition<a class="headerlink" href="#continuous-data-acquisition" title="Permalink to this heading">¶</a></h2>
<p>If you are capturing multiple frames or buffers of data, then there might arise situations where discontinuities appear in the samples, when plotted.</p>
<p>Some detail and tips are discussed in this wiki page on <a class="reference external" href="https://wiki.analog.com/resources/tools-software/linux-software/libiio_tips_tricks">IIO System Considerations, Tips and Tricks</a></p>
<p>The IIO buffer size is governed by the SamplesPerFrame property of the System Object classes. The kernelBuffersCount is also a property defined for the classes, and can be modified.</p>
</section>
</section>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../index.html">
              <img class="logo" src="../_static/adi_logo.png" alt="Logo"/>
            </a></p>
  <div>
    <h3><a href="../index.html">Table of Contents</a></h3>
    <ul>
<li><a class="reference internal" href="#">Data Streaming</a><ul>
<li><a class="reference internal" href="#connecting-and-configuration">Connecting and Configuration</a></li>
<li><a class="reference internal" href="#receiving-data">Receiving Data</a></li>
<li><a class="reference internal" href="#continuous-data-acquisition">Continuous Data Acquisition</a></li>
</ul>
</li>
</ul>

  </div>
  <div>
    <h4>Previous topic</h4>
    <p class="topless"><a href="installation.html"
                          title="previous chapter">Installation</a></p>
  </div>
  <div>
    <h4>Next topic</h4>
    <p class="topless"><a href="examples.html"
                          title="next chapter">Examples</a></p>
  </div>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../_sources/common/data_streaming.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="examples.html" title="Examples"
             >next</a> |</li>
        <li class="right" >
          <a href="installation.html" title="Installation"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">Precision Toolbox for MATLAB  documentation</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">Data Streaming</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2023, Analog Devices Inc..
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 5.3.0.
    </div>
  </body>
</html>